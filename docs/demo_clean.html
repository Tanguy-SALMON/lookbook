<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lookbook-MPC - AI Fashion Recommendations</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
    href="https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700&display=swap"
    rel="stylesheet"
    />
    <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
    />

    <script>
    tailwind.config = {
    theme: {
    extend: {
    colors: {
    cream: "#ffff",
    "cream-hover": "#f8f9fa",
    "dark-gray": "#0000",
    "text-primary": "#0000",
    "text-secondary": "#6666",
    "border-light": "#e5e5e5",
    accent: "#0000",
    },
    borderRadius: {
    pill: "47px",
    },
    fontSize: {
    label: "14px",
    },
    borderWidth: {
    1.5: "1.5px",
    },
    animation: {
    launch: "launch 2s ease-in-out infinite",
    float: "float 3s ease-in-out infinite",
    "pulse-glow": "pulseGlow 2s ease-in-out infinite",
    },
    keyframes: {
    launch: {
    "0%, 100%": { transform: "translateX(0) rotate(0deg)" },
    "50%": { transform: "translateX(8px) rotate(5deg)" },
    },
    float: {
    "0%, 100%": { transform: "translateY(0px)" },
    "50%": { transform: "translateY(-4px)" },
    },
    pulseGlow: {
    "0%, 100%": {
    filter: "drop-shadow(0 0 8px rgba(255, 191, 0, 0.6))",
    },
    "50%": {
    filter: "drop-shadow(0 0 16px rgba(255, 191, 0, 0.9))",
    },
    },
    },
    fontFamily: {
    onest: ["Onest", "sans-serif"],
    },
    },
    },
    };
    </script>

    <style>
    .icon-gradient {
    background: linear-gradient(135deg, #ffbf00 0%, #fb9937 100%);
    }
    .gold-gradient {
    background: linear-gradient(to right, #ffbf00, #ffbf00);
    }
    .text-accent {
    color: #0000;
    }
    .gold-icon-with-shadow-border {
    box-shadow: 0 1px 0px 0.4px rgba(255, 255, 255, 0.7),
    0 6px 9px rgba(0, 0, 0, 0.1);
    }

    /* Custom scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
    background: #f8f9fa;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #dee2e6;
    border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #adb5bd;
    }

    /* Typing animation */
    @keyframes typing {
    0%,
    60%,
    100% {
    transform: translateY(0);
    opacity: 0.4;
    }
    30% {
    transform: translateY(-8px);
    opacity: 1;
    }
    }

    .typing-dot {
    animation: typing 1.4s infinite;
    }
    .typing-dot:nth-child(2) {
    animation-delay: 0.2s;
    }
    .typing-dot:nth-child(3) {
    animation-delay: 0.4s;
    }

    /* Product card hover effect */
    .product-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .product-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
    0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    /* Connection status pulse animation */
    .status-connected {
    animation: statusPulse 2s ease-in-out infinite;
    }

    .status-disconnected {
    animation: statusError 1s ease-in-out infinite;
    }

    @keyframes statusPulse {
    0%,
    100% {
    opacity: 1;
    }
    50% {
    opacity: 0.8;
    }
    }

    @keyframes statusError {
    0%,
    100% {
    transform: scale(1);
    }
    50% {
    transform: scale(1.02);
    }
    }
    </style>
  </head>

  <body class="font-onest bg-[#f6f6f6] text-black min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 z-50 w-full bg-white border-b border-black">
    <div class="container mx-auto px-4">
    <div class="flex justify-between items-center py-4">
    <div class="flex items-center">
    <img src="../cos-chat2.png" class="h-10" />
    </div>

    <div class="hidden md:flex items-center space-x-8">
    <a
    href="#demo"
    class="text-black hover:text-gray-600 transition-colors text-sm uppercase tracking-wider"
    >Demo</a
    >
    <a
    href="#features"
    class="text-black hover:text-gray-600 transition-colors text-sm uppercase tracking-wider"
    >Features</a
    >
    <a
    href="#api"
    class="text-black hover:text-gray-600 transition-colors text-sm uppercase tracking-wider"
    >API</a
    >
    </div>

    <button class="md:hidden text-black">
    <i class="fas fa-bars"></i>
    </button>
    </div>
    </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-20 min-h-screen bg-white">
    <!-- Hero Section -->
    <section class="py-8 text-center">
    <div class="container mx-auto px-4">
    <h1
    class="text-2xl md:text-3xl font-light text-black mb-4 leading-tight tracking-wide"
    >
    AI Fashion Assistant
    </h1>
    <p
    class="text-sm md:text-base text-gray-600 mb-6 max-w-xl mx-auto leading-relaxed"
    >
    Personalized outfit recommendations powered by AI vision analysis
    </p>
    </div>
    </section>

    <!-- Demo Interface -->
    <section id="demo" class="pb-20">
    <div class="container mx-auto px-4">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden">


    <!-- Search Input -->
    <div class="w-full max-w-2xl mx-auto">
        <div class="relative bg-gray-100 rounded-2xl p-2 flex items-center space-x-2 shadow-[0_4px_12px_rgba(0,0,0,0.05)]">
            <textarea
                id="messageInput"
                placeholder="Send a message"
                class="flex-1 bg-transparent focus:outline-none text-gray-800 placeholder-gray-400 resize-none px-2 text-base"
                rows="1"
                onkeypress="handleKeyPress(event)"
            ></textarea>
            <div class="flex items-center space-x-2">
                <button id="sendButton" onclick="sendMessage()" class="w-9 h-9 flex items-center justify-center bg-gray-200 hover:bg-gray-300 transition-colors duration-200 rounded-full">
                    <svg
                        class="w-5 h-5 text-gray-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M5 10l7-7m0 0l7 7m-7-7v18"
                        ></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    </div>

    <div class="flex flex-col lg:flex-row min-h-[600px]">
    <!-- Sidebar -->
    <aside class="w-1/4 max-w-[240px] bg-gray-50/80 p-3 flex flex-col">
        <div class="flex items-center justify-between p-2">
            <div class="flex space-x-2">
                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
            </div>
            <svg
                class="w-5 h-5 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
            >
                <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
                ></path>
            </svg>
        </div>
        <div class="mt-4">
            <button class="w-full flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 transition-colors duration-200 text-gray-800 font-medium py-2.5 px-3 rounded-lg text-sm">
                <svg
                    class="w-4 h-4 text-gray-800"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"
                    ></path>
                </svg>
                <span>New Chat</span>
            </button>
        </div>
        <h3 class="text-base font-medium text-black mb-4 uppercase tracking-wider mt-4">
            Suggestions
        </h3>
        <div class="space-y-3">
            <div
                class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                onclick="sendSuggestion('I want to do yoga')"
            >
                <div class="font-medium text-black mb-1 text-sm">
                    Yoga Outfit
                </div>
                <p class="text-xs text-gray-600">
                    Comfortable and flexible activewear
                </p>
            </div>

            <div
                class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                onclick="sendSuggestion('Restaurant this weekend, attractive for $50')"
            >
                <div class="font-medium text-black mb-1 text-sm">
                    Dinner Date
                </div>
                <p class="text-xs text-gray-600">
                    Elegant looks within your budget
                </p>
            </div>

            <div
                class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                onclick="sendSuggestion('I am fat, look slim')"
            >
                <div class="font-medium text-black mb-1 text-sm">
                    Slimming Look
                </div>
                <p class="text-xs text-gray-600">
                    Flattering silhouettes and styles
                </p>
            </div>

            <div
                class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                onclick="sendSuggestion('Business meeting outfit for tomorrow')"
            >
                <div class="font-medium text-black mb-1 text-sm">
                    Business Meeting
                </div>
                <p class="text-xs text-gray-600">
                    Professional and polished looks
                </p>
            </div>

            <div
                class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                onclick="sendSuggestion('Casual weekend brunch with friends')"
            >
                <div class="font-medium text-black mb-1 text-sm">
                    Weekend Brunch
                </div>
                <p class="text-xs text-gray-600">
                    Relaxed yet stylish outfits
                </p>
            </div>
        </div>
    </aside>

    <!-- Chat Area -->
    <main class="flex-1 flex flex-col items-center justify-center p-6 relative">
        <!-- Messages -->
        <div id="messages" class="flex-1 p-6 overflow-y-auto custom-scrollbar bg-white w-full">
            <!-- Welcome Message -->
            <div class="flex-grow flex items-center justify-center">
                <div class="text-center">
                    <div class="inline-block p-4 rounded-full">
                        <svg
                            class="w-16 h-16 text-gray-800"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="1.5"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <path d="M16 16c0-2.21-1.79-4-4-4s-4 1.79-4 4"></path>
                            <path d="M12 12V8"></path>
                            <path d="M13 16c0 .55-.45 1-1 1s-1-.45-1-1"></path>
                            <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
                            <path d="M12 8c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
                            <path d="M15 12c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
                            <path d="M9 12c.552 0 1-.448 1-1s-.448-1-1-1-1 .448-1 1 .448 1 1 1z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

    </main>
    </div>
    </div>
    </div>
    </div>
    </section>

    <!-- Results Section -->
    <div id="resultsSection" class="hidden container mx-auto px-4 pb-20">
    <div class="bg-white border border-black p-8">
    <div
    class="flex items-center justify-between mb-6 border-b border-gray-300 pb-4"
    >
    <h3 class="text-xl font-light text-black tracking-wide uppercase">
    Search Results
    </h3>
    <span id="resultsCount" class="text-gray-600 text-sm"></span>
    </div>
    <div
    id="outfitGrid"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
    >
    <!-- Outfit cards will be inserted here -->
    </div>
    </div>
    </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black text-white py-12 border-t border-gray-300">
    <div class="container mx-auto px-4 text-center">
    <div class="flex items-center justify-center mb-4">
    <div
    class="w-8 h-8 bg-white rounded-full flex items-center justify-center mr-3"
    >
    <i class="fas fa-robot text-black text-sm"></i>
    </div>
    <div class="text-xl font-light">
    <span>Lookbook</span><span class="font-medium">MPC</span>
    </div>
    </div>
    <p class="text-gray-400 mb-6 text-sm">
    AI-Powered Fashion Recommendations
    </p>
    <div class="flex justify-center space-x-6">
    <a href="#" class="text-gray-400 hover:text-white transition-colors">
    <i class="fab fa-github text-lg"></i>
    </a>
    <a href="#" class="text-gray-400 hover:text-white transition-colors">
    <i class="fab fa-twitter text-lg"></i>
    </a>
    <a href="#" class="text-gray-400 hover:text-white transition-colors">
    <i class="fas fa-envelope text-lg"></i>
    </a>
    </div>
    </div>
    </footer>

    <script>
    const sessionId = generateSessionId();
    let isTyping = false;
    let connectionCheckInterval;

    function generateSessionId() {
    return (
    "session_" +
    Date.now() +
    "_" +
    Math.random().toString(36).substr(2, 9)
    );
    }

    function updateConnectionStatus(isConnected, message = "") {
    const statusElement = document.getElementById("connectionStatus");
    const iconElement = document.getElementById("connectionIcon");
    const textElement = document.getElementById("connectionText");

    if (isConnected) {
    statusElement.className = "text-xs text-black status-connected";
    iconElement.className = "fas fa-circle text-xs mr-1 text-green-600";
    textElement.textContent = "Connected";
    } else {
    statusElement.className = "text-xs text-black status-disconnected";
    iconElement.className = "fas fa-circle text-xs mr-1 text-red-600";
    textElement.textContent = message || "Disconnected";
    }
    }

    function checkApiHealth() {
    fetch("/health", {
    method: "GET",
    timeout: 5000,
    })
    .then((response) => {
    if (response.ok) {
    updateConnectionStatus(true);
    } else {
    updateConnectionStatus(false, "Service Error");
    }
    })
    .catch((error) => {
    console.warn("Health check failed:", error);
    updateConnectionStatus(false, "Disconnected");
    });
    }

    function checkChatHealth() {
    fetch("/v1/chat/suggestions", {
    method: "GET",
    timeout: 5000,
    })
    .then((response) => {
    if (response.ok) {
    updateConnectionStatus(true, "Chat Ready");
    } else {
    updateConnectionStatus(false, "Chat Service Error");
    }
    })
    .catch((error) => {
    console.warn("Chat health check failed:", error);
    updateConnectionStatus(false, "Chat Disconnected");
    });
    }

    function startConnectionMonitoring() {
    // Initial check
    checkChatHealth();

    // Check every 30 seconds
    connectionCheckInterval = setInterval(checkChatHealth, 30000);
    }

    function stopConnectionMonitoring() {
    if (connectionCheckInterval) {
    clearInterval(connectionCheckInterval);
    }
    }

    // Utility function to generate different image views
    function getImageVariations(baseImageUrl) {
    if (!baseImageUrl) {
    return {
    main: 'https://dummyimage.com/300x400/cccc/6666&text=No+Image',
    view2: 'https://dummyimage.com/300x400/cccc/6666&text=View+2',
    view3: 'https://dummyimage.com/300x400/cccc/6666&text=Detail'
    };
    }

    return {
    main: baseImageUrl,
    view2: baseImageUrl.replace(/_xxl-1\.(jpg|png)$/, '_xxl-2.$1'),
    view3: baseImageUrl.replace(/_xxl-1\.(jpg|png)$/, '_xxl-3.$1')
    };
    }

    // Utility function to generate product URL
    function getProductUrl(item) {
    if (item.product_url) {
    return item.product_url;
    }
    if (item.sku) {
    return `https://th.cos.com/th_en/${item.sku}.html`;
    }
    return '#';
    }

    function addMessage(content, isUser = false) {
    const messagesContainer = document.getElementById("messages");
    const messageDiv = document.createElement("div");

    messageDiv.className = `flex items-start mb-6 ${
    isUser ? "justify-end" : ""
    }`;

    if (isUser) {
    messageDiv.innerHTML = `
    <div class="bg-black text-white p-4 max-w-md mr-3 border-r-2 border-black">
    <p class="text-sm">${content}</p>
    </div>
    <div class="w-8 h-8 bg-gray-300 flex items-center justify-center flex-shrink-0">
    <i class="fas fa-user text-black text-xs"></i>
    </div>
    `;
    } else {
    messageDiv.innerHTML = `
    <div class="w-8 h-8 bg-black flex items-center justify-center mr-3 flex-shrink-0">
    <i class="fas fa-robot text-white text-xs"></i>
    </div>
    <div class="bg-gray-50 p-4 max-w-2xl border-l-2 border-black">
    <div class="text-gray-800 text-sm">${content}</div>
    </div>
    `;
    }

    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function addMessageWithProducts(content, outfits = []) {
    const messagesContainer = document.getElementById("messages");
    const messageDiv = document.createElement("div");

    messageDiv.className = "flex items-start mb-6";

    let productCardsHtml = "";

    if (outfits && outfits.length > 0) {
    outfits.forEach((outfit) => {
    const itemsHtml = outfit.items.map(item => {
    const images = getImageVariations(item.image_url);
    const productUrl = getProductUrl(item);
    return `
    <div class="border border-gray-200 rounded-lg overflow-hidden bg-white transition-transform duration-200 hover:-translate-y-0.5 mb-3">
    <a href="https://th.cos.com/th_en/${item.sku}.html" target="_blank" class="no-underline text-inherit block">
    <div class="flex gap-2 mb-2">
    <img src="${images.main}"
    alt="${item.title}"
    class="flex-1 h-40 object-cover object-top rounded-md"
    onerror="this.src='https://dummyimage.com/300x400/cccc/6666&text=No+Image'">
    <img src="${images.view2}"
    alt="${item.title} - Side View"
    class="flex-1 h-40 object-cover object-top rounded-md"
    onerror="this.src='https://dummyimage.com/300x400/cccc/6666&text=View+2'">
    <img src="${images.view3}"
    alt="${item.title} - Detail"
    class="flex-1 h-40 object-contain bg-gray-50 rounded-md"
    onerror="this.src='https://dummyimage.com/300x400/cccc/6666&text=Detail'">
    </div>
    <div class="p-2">
    <div class="text-xs font-medium text-gray-800 mb-1 leading-tight">${item.title}</div>
    <div class="text-xs font-semibold text-blue-500">฿${item.price}</div>
    </div>
    </a>
    </div>
    `;}).join("");

    productCardsHtml += `
    <div class="bg-white border border-gray-200 rounded-xl p-4 mt-3 max-w-md">
    <div class="text-sm text-gray-600 mb-2">${outfit.title}:</div>
    <div class="grid grid-cols-1 gap-3 max-w-sm">
    ${outfit.items.map(item => {
    const images = getImageVariations(item.image_url);
    const productUrl = getProductUrl(item);
    return `
    <div class="border border-gray-200 rounded-lg overflow-hidden bg-white transition-transform duration-200 hover:-translate-y-0.5">
    <a href="https://th.cos.com/th_en/${item.sku}.html" target="_blank" class="no-underline text-inherit block">
    <div class="flex gap-2 mb-2">
    <img src="${images.main}"
    alt="${item.title}"
    class="flex-1 h-40 object-cover object-top rounded-md"
    onerror="this.src='https://dummyimage.com/300x400/cccc/6666&text=No+Image'">
    <img src="${images.view2}"
    alt="${item.title} - Side View"
    class="flex-1 h-40 object-cover object-top rounded-md"
    onerror="this.src='https://dummyimage.com/300x400/cccc/6666&text=View+2'">
    <img src="${images.view3}"
    alt="${item.title} - Detail"
    class="flex-1 h-40 object-contain bg-gray-50 rounded-md"
    onerror="this.src='https://dummyimage.com/300x400/cccc/6666&text=Detail'">
    </div>
    <div class="p-2">
    <div class="text-xs font-medium text-gray-800 mb-1 leading-tight">${item.title}</div>
    <div class="text-xs font-semibold text-blue-500">฿${item.price}</div>
    </div>
    </a>
    </div>
    `;}).join('')}
    </div>
    </div>
    `;
    });
    }

    messageDiv.innerHTML = `
    <div class="w-8 h-8 bg-black flex items-center justify-center mr-3 flex-shrink-0">
    <i class="fas fa-robot text-white text-xs"></i>
    </div>
    <div class="max-w-[70%] p-3 px-4 rounded-2xl text-sm leading-normal font-normal bg-gray-100 text-gray-800 self-start rounded-bl-sm">
    ${content}
    ${productCardsHtml}
    <div class="text-xs text-gray-400 mt-1 text-right font-normal">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
    </div>
    `;

    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function showTypingIndicator() {
    if (!isTyping) {
    isTyping = true;
    document.getElementById("typingIndicator").classList.remove("hidden");
    document.getElementById("messages").scrollTop =
    document.getElementById("messages").scrollHeight;
    }
    }

    function hideTypingIndicator() {
    isTyping = false;
    document.getElementById("typingIndicator").classList.add("hidden");
    }

    function addOutfitCard(outfit) {
    const outfitGrid = document.getElementById("outfitGrid");
    const resultsSection = document.getElementById("resultsSection");

    resultsSection.classList.remove("hidden");

    const outfitCard = document.createElement("div");
    outfitCard.className =
    "product-card bg-white border border-black overflow-hidden";

    const itemsHtml = outfit.items
    .slice(0, 4)
    .map(
    (item) => `
    <div class="flex-1 text-center">
    <div class="aspect-square bg-gray-100 mb-3 overflow-hidden">
    <img
    src="${
    item.image_url ||
    "https://via.placeholder.com/200x200?text=No+Image"
    }"
    alt="${item.title || "Fashion Item"}"
    class="w-full h-full object-cover"
    loading="lazy"
    >
    </div>
    <div class="text-xs text-gray-700 mb-1 truncate">${
    item.title || "Fashion Item"
    }</div>
    <div class="text-sm font-medium text-black">$${
    item.price || "0.00"
    }</div>
    </div>
    `
    )
    .join("");

    outfitCard.innerHTML = `
    <div class="p-6">
    <div class="flex items-center justify-between mb-4">
    <h4 class="text-base font-medium text-black uppercase tracking-wider">Complete Outfit</h4>
    <div class="flex items-center text-xs text-gray-600">
    <span>${
    outfit.score
    ? (outfit.score * 100).toFixed(0) + "%"
    : "95%"
    } Match</span>
    </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
    ${itemsHtml}
    </div>

    <div class="bg-gray-50 p-4 border-l-2 border-black">
    <p class="text-xs text-gray-700">${
    outfit.rationale ||
    "This outfit combines style and comfort perfectly for your needs."
    }</p>
    </div>

    <div class="mt-4 pt-4 border-t border-gray-300">
    <div class="flex items-center justify-between">
    <div class="text-base font-medium text-black">
    Total: $${outfit.items
    .reduce(
    (sum, item) =>
    sum + (parseFloat(item.price) || 0),
    0
    )
    .toFixed(2)}
    </div>
    <button class="bg-black hover:bg-gray-800 text-white px-4 py-2 text-xs font-medium transition-colors uppercase tracking-wider">
    Save Outfit
    </button>
    </div>
    </div>
    </div>
    `;

    outfitGrid.appendChild(outfitCard);

    // Update results count
    const count = outfitGrid.children.length;
    document.getElementById("resultsCount").textContent = `${count} outfit${
    count !== 1 ? "s" : ""
    } found`;
    }

    function sendMessage() {
    const input = document.getElementById("messageInput");
    const message = input.value.trim();

    if (!message) return;

    // Add user message
    addMessage(message, true);
    input.value = "";

    // Clear previous results
    document.getElementById("outfitGrid").innerHTML = "";
    document.getElementById("resultsSection").classList.add("hidden");

    // Show typing indicator
    showTypingIndicator();

    // Disable send button
    document.getElementById("sendButton").disabled = true;

    // Send to API
    fetch("/v1/chat", {
    method: "POST",
    headers: {
    "Content-Type": "application/json",
    },
    body: JSON.stringify({
    session_id: sessionId,
    message: message,
    }),
    })
    .then((response) => response.json())
    .then((data) => {
    hideTypingIndicator();

    // Add assistant response with embedded products if any
    if (data.replies && data.replies.length > 0) {
    if (data.outfits && data.outfits.length > 0) {
    // Show message with embedded product cards
    addMessageWithProducts(data.replies[0].message, data.outfits);
    } else {
    // Show simple message
    addMessage(data.replies[0].message);
    }
    }

    // Also add outfit cards to the separate grid for additional display
    if (data.outfits && data.outfits.length > 0) {
    data.outfits.forEach((outfit) => {
    addOutfitCard(outfit);
    });
    }

    // Enable send button
    document.getElementById("sendButton").disabled = false;
    })
    .catch((error) => {
    hideTypingIndicator();
    updateConnectionStatus(false, "API Error");
    addMessage(
    "Sorry, I encountered an error. The service appears to be disconnected. Please try again."
    );
    document.getElementById("sendButton").disabled = false;
    console.error("Error:", error);
    });
    }

    function sendSuggestion(text) {
    document.getElementById("messageInput").value = text;
    sendMessage();
    }

    function handleKeyPress(event) {
    if (event.key === "Enter") {
    sendMessage();
    }
    }

    // Focus input on load and start monitoring
    // Reset chat function
    function resetChat() {
    if (confirm("Are you sure you want to clear all messages?")) {
    const chatMessages = document.getElementById("messages");
    if (chatMessages) {
    chatMessages.innerHTML = "";
    }

    // Clear the input field
    const messageInput = document.getElementById("messageInput");
    if (messageInput) {
    messageInput.value = "";
    }

    // Hide typing indicator if visible
    hideTypingIndicator();

    // Add welcome message
    setTimeout(() => {
    addMessage(
    "assistant",
    "Hello! I'm your AI Fashion Assistant. Describe what you're looking for and I'll help you find the perfect outfit!"
    );
    }, 300);
    }
    }

    document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("messageInput").focus();
    startConnectionMonitoring();
    });

    // Stop monitoring when page unloads
    window.addEventListener("beforeunload", function () {
    stopConnectionMonitoring();
    });

    // Smooth scrolling for navigation
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute("href"));
    if (target) {
    target.scrollIntoView({
    behavior: "smooth",
    block: "start",
    });
    }
    });
    });
    </script>
  </body>
</html>
