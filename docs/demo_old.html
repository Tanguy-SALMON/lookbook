<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lookbook-MPC - AI Fashion Recommendations</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              cream: "#ffffff",
              "cream-hover": "#f8f9fa",
              "dark-gray": "#000000",
              "text-primary": "#000000",
              "text-secondary": "#666666",
              "border-light": "#e5e5e5",
              accent: "#000000",
            },
            borderRadius: {
              pill: "47px",
            },
            fontSize: {
              label: "14px",
            },
            borderWidth: {
              1.5: "1.5px",
            },
            animation: {
              launch: "launch 2s ease-in-out infinite",
              float: "float 3s ease-in-out infinite",
              "pulse-glow": "pulseGlow 2s ease-in-out infinite",
            },
            keyframes: {
              launch: {
                "0%, 100%": { transform: "translateX(0) rotate(0deg)" },
                "50%": { transform: "translateX(8px) rotate(5deg)" },
              },
              float: {
                "0%, 100%": { transform: "translateY(0px)" },
                "50%": { transform: "translateY(-4px)" },
              },
              pulseGlow: {
                "0%, 100%": {
                  filter: "drop-shadow(0 0 8px rgba(255, 191, 0, 0.6))",
                },
                "50%": {
                  filter: "drop-shadow(0 0 16px rgba(255, 191, 0, 0.9))",
                },
              },
            },
            fontFamily: {
              onest: ["Onest", "sans-serif"],
            },
          },
        },
      };
    </script>

    <style>
      .icon-gradient {
        background: linear-gradient(135deg, #ffbf00 0%, #fb9937 100%);
      }
      .gold-gradient {
        background: linear-gradient(to right, #ffbf00, #ffbf00);
      }
      .text-accent {
        color: #000000;
      }
      .gold-icon-with-shadow-border {
        box-shadow: 0 1px 0px 0.4px rgba(255, 255, 255, 0.7),
          0 6px 9px rgba(0, 0, 0, 0.1);
      }

      /* Custom scrollbar */
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f8f9fa;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #dee2e6;
        border-radius: 3px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #adb5bd;
      }

      /* Typing animation */
      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.4;
        }
        30% {
          transform: translateY(-8px);
          opacity: 1;
        }
      }

      .typing-dot {
        animation: typing 1.4s infinite;
      }
      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      /* Product card hover effect */
      .product-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .product-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      /* Connection status pulse animation */
      .status-connected {
        animation: statusPulse 2s ease-in-out infinite;
      }

      .status-disconnected {
        animation: statusError 1s ease-in-out infinite;
      }

      @keyframes statusPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }

      @keyframes statusError {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }
    </style>
  </head>

  <body class="font-onest bg-white text-black min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 z-50 w-full bg-white border-b border-black">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center">
            <img src="../cos-chat2.png" class="h-10" />
          </div>

          <div class="hidden md:flex items-center space-x-8">
            <a
              href="#demo"
              class="text-black hover:text-gray-600 transition-colors text-sm uppercase tracking-wider"
              >Demo</a
            >
            <a
              href="#features"
              class="text-black hover:text-gray-600 transition-colors text-sm uppercase tracking-wider"
              >Features</a
            >
            <a
              href="#api"
              class="text-black hover:text-gray-600 transition-colors text-sm uppercase tracking-wider"
              >API</a
            >
          </div>

          <button class="md:hidden text-black">
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-20 min-h-screen bg-white">
      <!-- Hero Section -->
      <section class="py-8 text-center">
        <div class="container mx-auto px-4">
          <h1
            class="text-2xl md:text-3xl font-light text-black mb-4 leading-tight tracking-wide"
          >
            AI Fashion Assistant
          </h1>
          <p
            class="text-sm md:text-base text-gray-600 mb-6 max-w-xl mx-auto leading-relaxed"
          >
            Personalized outfit recommendations powered by AI vision analysis
          </p>
        </div>
      </section>

      <!-- Demo Interface -->
      <section id="demo" class="pb-20">
        <div class="container mx-auto px-4">
          <div
            class="max-w-7xl mx-auto bg-white border border-black overflow-hidden"
          >
            <!-- Search Header -->
            <div class="bg-white border-b border-black p-6">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-light text-black tracking-wide">
                  Search for Outfits
                </h2>
                <span id="connectionStatus" class="text-xs px-2 py-1">
                  <i id="connectionIcon" class="fas fa-circle text-xs mr-1"></i>
                  <span id="connectionText">Checking...</span>
                </span>
              </div>

              <!-- Search Input -->
              <div class="relative">
                <input
                  type="text"
                  id="messageInput"
                  placeholder="Describe what you're looking for... e.g., 'I want to do yoga'"
                  class="w-full px-6 py-4 bg-white border border-black text-base focus:outline-none transition-all"
                  onkeypress="handleKeyPress(event)"
                />
                <button
                  id="sendButton"
                  onclick="sendMessage()"
                  class="absolute right-16 top-1/2 transform -translate-y-1/2 bg-black hover:bg-gray-800 text-white w-12 h-12 flex items-center justify-center transition-all"
                >
                  <i class="fas fa-arrow-right"></i>
                </button>
                <button
                  id="resetButton"
                  onclick="resetChat()"
                  class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-red-500 hover:bg-red-600 text-white w-12 h-12 flex items-center justify-center transition-all"
                  title="Clear all messages"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>

            <div class="flex flex-col lg:flex-row min-h-[600px]">
              <!-- Sidebar -->
              <div class="lg:w-80 bg-gray-50 border-r border-black p-6">
                <h3
                  class="text-base font-medium text-black mb-4 uppercase tracking-wider"
                >
                  Suggestions
                </h3>

                <div class="space-y-3">
                  <div
                    class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                    onclick="sendSuggestion('I want to do yoga')"
                  >
                    <div class="font-medium text-black mb-1 text-sm">
                      Yoga Outfit
                    </div>
                    <p class="text-xs text-gray-600">
                      Comfortable and flexible activewear
                    </p>
                  </div>

                  <div
                    class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                    onclick="sendSuggestion('Restaurant this weekend, attractive for $50')"
                  >
                    <div class="font-medium text-black mb-1 text-sm">
                      Dinner Date
                    </div>
                    <p class="text-xs text-gray-600">
                      Elegant looks within your budget
                    </p>
                  </div>

                  <div
                    class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                    onclick="sendSuggestion('I am fat, look slim')"
                  >
                    <div class="font-medium text-black mb-1 text-sm">
                      Slimming Look
                    </div>
                    <p class="text-xs text-gray-600">
                      Flattering silhouettes and styles
                    </p>
                  </div>

                  <div
                    class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                    onclick="sendSuggestion('Business meeting outfit for tomorrow')"
                  >
                    <div class="font-medium text-black mb-1 text-sm">
                      Business Meeting
                    </div>
                    <p class="text-xs text-gray-600">
                      Professional and polished looks
                    </p>
                  </div>

                  <div
                    class="suggestion-card bg-white p-3 border border-gray-300 cursor-pointer hover:border-black hover:bg-gray-50 transition-all"
                    onclick="sendSuggestion('Casual weekend brunch with friends')"
                  >
                    <div class="font-medium text-black mb-1 text-sm">
                      Weekend Brunch
                    </div>
                    <p class="text-xs text-gray-600">
                      Relaxed yet stylish outfits
                    </p>
                  </div>
                </div>
              </div>

              <!-- Chat Area -->
              <div class="flex-1 flex flex-col">
                <!-- Messages -->
                <div
                  id="messages"
                  class="flex-1 p-6 overflow-y-auto custom-scrollbar bg-white"
                >
                  <!-- Welcome Message -->
                  <div class="flex items-start mb-6">
                    <div
                      class="w-8 h-8 bg-black flex items-center justify-center mr-3 flex-shrink-0"
                    >
                      <i class="fas fa-robot text-white text-xs"></i>
                    </div>
                    <div
                      class="bg-gray-50 p-4 max-w-md border-l-2 border-black"
                    >
                      <p class="text-gray-800 text-sm">
                        Hello! I'm your AI fashion assistant. I can help you
                        find the perfect outfits for any occasion. What are you
                        looking for today?
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-6 py-2">
                  <div class="flex items-center">
                    <div
                      class="w-8 h-8 bg-black flex items-center justify-center mr-3"
                    >
                      <i class="fas fa-robot text-white text-xs"></i>
                    </div>
                    <div class="bg-gray-100 px-4 py-3 border-l-2 border-black">
                      <div class="flex space-x-1">
                        <div
                          class="w-2 h-2 bg-black rounded-full typing-dot"
                        ></div>
                        <div
                          class="w-2 h-2 bg-black rounded-full typing-dot"
                        ></div>
                        <div
                          class="w-2 h-2 bg-black rounded-full typing-dot"
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Results Section -->
      <div id="resultsSection" class="hidden container mx-auto px-4 pb-20">
        <div class="bg-white border border-black p-8">
          <div
            class="flex items-center justify-between mb-6 border-b border-gray-300 pb-4"
          >
            <h3 class="text-xl font-light text-black tracking-wide uppercase">
              Search Results
            </h3>
            <span id="resultsCount" class="text-gray-600 text-sm"></span>
          </div>
          <div
            id="outfitGrid"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
          >
            <!-- Outfit cards will be inserted here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black text-white py-12 border-t border-gray-300">
      <div class="container mx-auto px-4 text-center">
        <div class="flex items-center justify-center mb-4">
          <div
            class="w-8 h-8 bg-white rounded-full flex items-center justify-center mr-3"
          >
            <i class="fas fa-robot text-black text-sm"></i>
          </div>
          <div class="text-xl font-light">
            <span>Lookbook</span><span class="font-medium">MPC</span>
          </div>
        </div>
        <p class="text-gray-400 mb-6 text-sm">
          AI-Powered Fashion Recommendations
        </p>
        <div class="flex justify-center space-x-6">
          <a href="#" class="text-gray-400 hover:text-white transition-colors">
            <i class="fab fa-github text-lg"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-white transition-colors">
            <i class="fab fa-twitter text-lg"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-white transition-colors">
            <i class="fas fa-envelope text-lg"></i>
          </a>
        </div>
      </div>
    </footer>

    <script>
      const sessionId = generateSessionId();
      let isTyping = false;
      let connectionCheckInterval;

      function generateSessionId() {
        return (
          "session_" +
          Date.now() +
          "_" +
          Math.random().toString(36).substr(2, 9)
        );
      }

      function updateConnectionStatus(isConnected, message = "") {
        const statusElement = document.getElementById("connectionStatus");
        const iconElement = document.getElementById("connectionIcon");
        const textElement = document.getElementById("connectionText");

        if (isConnected) {
          statusElement.className = "text-xs text-black status-connected";
          iconElement.className = "fas fa-circle text-xs mr-1 text-green-600";
          textElement.textContent = "Connected";
        } else {
          statusElement.className = "text-xs text-black status-disconnected";
          iconElement.className = "fas fa-circle text-xs mr-1 text-red-600";
          textElement.textContent = message || "Disconnected";
        }
      }

      function checkApiHealth() {
        fetch("/health", {
          method: "GET",
          timeout: 5000,
        })
          .then((response) => {
            if (response.ok) {
              updateConnectionStatus(true);
            } else {
              updateConnectionStatus(false, "Service Error");
            }
          })
          .catch((error) => {
            console.warn("Health check failed:", error);
            updateConnectionStatus(false, "Disconnected");
          });
      }

      function checkChatHealth() {
        fetch("/v1/chat/suggestions", {
          method: "GET",
          timeout: 5000,
        })
          .then((response) => {
            if (response.ok) {
              updateConnectionStatus(true, "Chat Ready");
            } else {
              updateConnectionStatus(false, "Chat Service Error");
            }
          })
          .catch((error) => {
            console.warn("Chat health check failed:", error);
            updateConnectionStatus(false, "Chat Disconnected");
          });
      }

      function startConnectionMonitoring() {
        // Initial check
        checkChatHealth();

        // Check every 30 seconds
        connectionCheckInterval = setInterval(checkChatHealth, 30000);
      }

      function stopConnectionMonitoring() {
        if (connectionCheckInterval) {
          clearInterval(connectionCheckInterval);
        }
      }

      // Utility function to generate different image views
      function getImageVariations(baseImageUrl) {
        if (!baseImageUrl) {
          return {
            main: "https://dummyimage.com/300x400/cccccc/666666&text=No+Image",
            view2: "https://dummyimage.com/300x400/cccccc/666666&text=View+2",
            view3: "https://dummyimage.com/300x400/cccccc/666666&text=Detail",
          };
        }

        return {
          main: baseImageUrl,
          view2: baseImageUrl.replace(/_xxl-1\.(jpg|png)$/, "_xxl-2.$1"),
          view3: baseImageUrl.replace(/_xxl-1\.(jpg|png)$/, "_xxl-3.$1"),
        };
      }

      // Utility function to generate product URL
      function getProductUrl(item) {
        if (item.product_url) {
          return item.product_url;
        }
        if (item.sku) {
          return `https://th.cos.com/th_en/${item.sku}.html`;
        }
        return "#";
      }

      function addMessage(content, isUser = false) {
        const messagesContainer = document.getElementById("messages");
        const messageDiv = document.createElement("div");

        messageDiv.className = `flex items-start mb-6 ${
          isUser ? "justify-end" : ""
        }`;

        if (isUser) {
          messageDiv.innerHTML = `
                    <div class="bg-black text-white p-4 max-w-md mr-3 border-r-2 border-black">
                        <p class="text-sm">${content}</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-300 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user text-black text-xs"></i>
                    </div>
                `;
        } else {
          messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-black flex items-center justify-center mr-3 flex-shrink-0">
                        <i class="fas fa-robot text-white text-xs"></i>
                    </div>
                    <div class="bg-gray-50 p-4 max-w-2xl border-l-2 border-black">
                        <div class="text-gray-800 text-sm">${content}</div>
                    </div>
                `;
        }

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function addMessageWithProducts(content, outfits = []) {
        const messagesContainer = document.getElementById("messages");
        const messageDiv = document.createElement("div");

        messageDiv.className = "flex items-start mb-6";

        let productCardsHtml = "";

        if (outfits && outfits.length > 0) {
          outfits.forEach((outfit) => {
            const itemsHtml = outfit.items
              .map((item) => {
                const images = getImageVariations(item.image_url);
                return `
              <div class="border border-gray-200 rounded-lg overflow-hidden bg-white transition-transform duration-200 hover:-translate-y-0.5 mb-3">
                <a href="${item.product_url}" target="_blank" class="no-underline text-inherit block">
                  <div class="flex gap-2 mb-2">
                    <img src="${images.main}"
                         alt="${item.title}"
                         class="flex-1 h-40 object-cover object-top rounded-md"
                         onerror="this.src='https://dummyimage.com/300x400/cccccc/666666&text=No+Image'">
                    <img src="${images.view2}"
                         alt="${item.title} - Side View"
                         class="flex-1 h-40 object-cover object-top rounded-md"
                         onerror="this.src='https://dummyimage.com/300x400/cccccc/666666&text=View+2'">
                    <img src="${images.view3}"
                         alt="${item.title} - Detail"
                         class="flex-1 h-40 object-contain bg-gray-50 rounded-md"
                         onerror="this.src='https://dummyimage.com/300x400/cccccc/666666&text=Detail'">
                  </div>
                  <div class="p-2">
                    <div class="text-xs font-medium text-gray-800 mb-1 leading-tight">${item.title}</div>
                    <div class="text-xs font-semibold text-blue-500">฿${item.price}</div>
                  </div>
                </a>
              </div>
            `;
              })
              .join("");

            productCardsHtml += `
              <div class="bg-white border border-gray-200 rounded-xl p-4 mt-3 max-w-md">
                <div class="text-sm text-gray-600 mb-2">${outfit.title}:</div>
                <div class="grid grid-cols-1 gap-3 max-w-sm">
                  ${outfit.items
                    .map((item) => {
                      const images = getImageVariations(item.image_url);
                      const productUrl = getProductUrl(item);
                      return `
                    <div class="border border-gray-200 rounded-lg overflow-hidden bg-white transition-transform duration-200 hover:-translate-y-0.5">
                      <a href="${item.product_url}" target="_blank" class="no-underline text-inherit block">
                        <div class="flex gap-2 mb-2">
                          <img src="${images.main}"
                               alt="${item.title}"
                               class="flex-1 h-40 object-cover object-top rounded-md"
                               onerror="this.src='https://dummyimage.com/300x400/cccccc/666666&text=No+Image'">
                          <img src="${images.view2}"
                               alt="${item.title} - Side View"
                               class="flex-1 h-40 object-cover object-top rounded-md"
                               onerror="this.src='https://dummyimage.com/300x400/cccccc/666666&text=View+2'">
                          <img src="${images.view3}"
                               alt="${item.title} - Detail"
                               class="flex-1 h-40 object-contain bg-gray-50 rounded-md"
                               onerror="this.src='https://dummyimage.com/300x400/cccccc/666666&text=Detail'">
                        </div>
                        <div class="p-2">
                          <div class="text-xs font-medium text-gray-800 mb-1 leading-tight">${item.title}</div>
                          <div class="text-xs font-semibold text-blue-500">฿${item.price}</div>
                        </div>
                      </a>
                    </div>
                  `;
                    })
                    .join("")}
                </div>
              </div>
            `;
          });
        }

        messageDiv.innerHTML = `
          <div class="w-8 h-8 bg-black flex items-center justify-center mr-3 flex-shrink-0">
            <i class="fas fa-robot text-white text-xs"></i>
          </div>
          <div class="max-w-[70%] p-3 px-4 rounded-2xl text-sm leading-normal font-normal bg-gray-100 text-gray-800 self-start rounded-bl-sm">
            ${content}
            ${productCardsHtml}
            <div class="text-xs text-gray-400 mt-1 text-right font-normal">${new Date().toLocaleTimeString(
              [],
              { hour: "2-digit", minute: "2-digit" }
            )}</div>
          </div>
        `;

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function showTypingIndicator() {
        if (!isTyping) {
          isTyping = true;
          document.getElementById("typingIndicator").classList.remove("hidden");
          document.getElementById("messages").scrollTop =
            document.getElementById("messages").scrollHeight;
        }
      }

      function hideTypingIndicator() {
        isTyping = false;
        document.getElementById("typingIndicator").classList.add("hidden");
      }

      function addOutfitCard(outfit) {
        const outfitGrid = document.getElementById("outfitGrid");
        const resultsSection = document.getElementById("resultsSection");

        resultsSection.classList.remove("hidden");

        const outfitCard = document.createElement("div");
        outfitCard.className =
          "product-card bg-white border border-black overflow-hidden";

        const itemsHtml = outfit.items
          .slice(0, 4)
          .map(
            (item) => `
                <div class="flex-1 text-center">
                    <div class="aspect-square bg-gray-100 mb-3 overflow-hidden">
                        <img
                            src="${
                              item.image_url ||
                              "https://via.placeholder.com/200x200?text=No+Image"
                            }"
                            alt="${item.title || "Fashion Item"}"
                            class="w-full h-full object-cover"
                            loading="lazy"
                        >
                    </div>
                    <div class="text-xs text-gray-700 mb-1 truncate">${
                      item.title || "Fashion Item"
                    }</div>
                    <div class="text-sm font-medium text-black">$${
                      item.price || "0.00"
                    }</div>
                </div>
            `
          )
          .join("");

        outfitCard.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-base font-medium text-black uppercase tracking-wider">Complete Outfit</h4>
                        <div class="flex items-center text-xs text-gray-600">
                            <span>${
                              outfit.score
                                ? (outfit.score * 100).toFixed(0) + "%"
                                : "95%"
                            } Match</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        ${itemsHtml}
                    </div>

                    <div class="bg-gray-50 p-4 border-l-2 border-black">
                        <p class="text-xs text-gray-700">${
                          outfit.rationale ||
                          "This outfit combines style and comfort perfectly for your needs."
                        }</p>
                    </div>

                    <div class="mt-4 pt-4 border-t border-gray-300">
                        <div class="flex items-center justify-between">
                            <div class="text-base font-medium text-black">
                                Total: $${outfit.items
                                  .reduce(
                                    (sum, item) =>
                                      sum + (parseFloat(item.price) || 0),
                                    0
                                  )
                                  .toFixed(2)}
                            </div>
                            <button class="bg-black hover:bg-gray-800 text-white px-4 py-2 text-xs font-medium transition-colors uppercase tracking-wider">
                                Save Outfit
                            </button>
                        </div>
                    </div>
                </div>
            `;

        outfitGrid.appendChild(outfitCard);

        // Update results count
        const count = outfitGrid.children.length;
        document.getElementById("resultsCount").textContent = `${count} outfit${
          count !== 1 ? "s" : ""
        } found`;
      }

      function sendMessage() {
        const input = document.getElementById("messageInput");
        const message = input.value.trim();

        if (!message) return;

        // Add user message
        addMessage(message, true);
        input.value = "";

        // Clear previous results
        document.getElementById("outfitGrid").innerHTML = "";
        document.getElementById("resultsSection").classList.add("hidden");

        // Show typing indicator
        showTypingIndicator();

        // Disable send button
        document.getElementById("sendButton").disabled = true;

        // Send to API
        fetch("/v1/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            session_id: sessionId,
            message: message,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            hideTypingIndicator();

            // Add assistant response with embedded products if any
            if (data.replies && data.replies.length > 0) {
              if (data.outfits && data.outfits.length > 0) {
                // Show message with embedded product cards
                addMessageWithProducts(data.replies[0].message, data.outfits);
              } else {
                // Show simple message
                addMessage(data.replies[0].message);
              }
            }

            // Also add outfit cards to the separate grid for additional display
            if (data.outfits && data.outfits.length > 0) {
              data.outfits.forEach((outfit) => {
                addOutfitCard(outfit);
              });
            }

            // Enable send button
            document.getElementById("sendButton").disabled = false;
          })
          .catch((error) => {
            hideTypingIndicator();
            updateConnectionStatus(false, "API Error");
            addMessage(
              "Sorry, I encountered an error. The service appears to be disconnected. Please try again."
            );
            document.getElementById("sendButton").disabled = false;
            console.error("Error:", error);
          });
      }

      function sendSuggestion(text) {
        document.getElementById("messageInput").value = text;
        sendMessage();
      }

      function handleKeyPress(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      }

      // Focus input on load and start monitoring
      // Reset chat function
      function resetChat() {
        if (confirm("Are you sure you want to clear all messages?")) {
          const chatMessages = document.getElementById("messages");
          if (chatMessages) {
            chatMessages.innerHTML = "";
          }

          // Clear the input field
          const messageInput = document.getElementById("messageInput");
          if (messageInput) {
            messageInput.value = "";
          }

          // Hide typing indicator if visible
          hideTypingIndicator();

          // Add welcome message
          setTimeout(() => {
            addMessage(
              "assistant",
              "Hello! I'm your AI Fashion Assistant. Describe what you're looking for and I'll help you find the perfect outfit!"
            );
          }, 300);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("messageInput").focus();
        startConnectionMonitoring();
      });

      // Stop monitoring when page unloads
      window.addEventListener("beforeunload", function () {
        stopConnectionMonitoring();
      });

      // Smooth scrolling for navigation
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute("href"));
          if (target) {
            target.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
          }
        });
      });
    </script>
  </body>
</html>
